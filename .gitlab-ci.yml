## Comment out FRESCO CI
#variables:
#  DOCKER_IMAGE: registry.gitlab.com/partisia/dockerimages/maven-jdk9:latest
#
#image: $DOCKER_IMAGE
#
#run-test:
#  stage: build
#  script:
#    - mvn test
#  artifacts:
#    paths:
#      - core/target/site/jacoco
#      - suite/spdz/target/site/jacoco
#      - suite/spdz2k/target/site/jacoco
#      - suite/tinytables/target/site/jacoco
#      - tools/mascot/target/site/jacoco
#      - tools/ot/target/site/jacoco

## Our own for now
include:
- local: 'git-version-setup.yml'
- local: 'version-bump.yml'

.java-get-current-version: &java-get-current-version
- '# shellcheck disable=SC2034'
- CURRENT_VERSION=$(mvn help:evaluate -Dexpression=project.version -q -DforceStdout)

.java-set-new-version: &java-set-new-version
- mvn versions:set -DnewVersion="$NEW_VERSION"

java-deploy-test-version:
  extends: .maven
  stage: test
  script:
  - *java-get-current-version
  - !reference [.beta-version-from-current, script]
  - *java-set-new-version
  - mvn -DskipTests -DadditionalJOption=-Xdoclint:none -Djib.skip deploy
  allow_failure: true
